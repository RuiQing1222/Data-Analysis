假设有点问题。麻烦@安捷敏 再看一下，完成Task ID：3101131，未完成Task ID：3101132的玩家，下面这些维度的数据情况。满足这个条件，未修建过的玩家也麻烦找出来。放在一起就行。

select a.role_id,user_id,server_id,3101161接取时间,3101161完成时间,f1,f2,date_time,complete_stage,pay
from

(select role_id ,user_id,server_id
from fairy_town_server.server_map_enter
where day_time>=20221026 and day_time <= 20221105
and server_id in (10001,10002,10003)
and map_id='31010001'
group by 1,2,3) as a

left join
(select b1.role_id,b1.date_time as '3101161完成时间',b2.date_time as '3101161接取时间'
from
(SELECT role_id,date_time from   
fairy_town_server.server_task_completed
where task_id = '3101161'
and day_time >= 20221026 and day_time <= 20221105
and role_id not in 
(SELECT DISTINCT role_id from fairy_town_server.server_task_completed where task_id = '3101162' and day_time >= 20221026 and day_time <= 20221105)
) as b1
left join
(SELECT role_id,date_time from   
fairy_town_server.server_task_accept
where task_id = '3101161'
and day_time >= 20221026 and day_time <= 20221105) as b2
on b1.role_id = b2.role_id
) as b
on a.role_id=b.role_id

left join
(
select a.role_id,f1,f2,date_time,complete_stage,pay
from 
(select date_time,role_id,building_id,complete_stage
from 
(select date_time,role_id,building_id ,complete_stage,row_number()over(partition by role_id order by complete_stage desc) as row_num
from fairy_town_server.server_building_complete
where day_time>=20221026 and day_time <= 20221105
and server_id in (10001,10002,10003)
and building_id= '4003033'
) a1
where row_num =1 
) a 
left join 
(
select role_id,
max(case when day_time<=20211107  then 1  else 0 end) as 'f1',
max(case when day_time>=20220324  then 1  else 0 end) as 'f2'
from 
(select role_id,day_time 
from fairy_town_server.server_map_enter
where day_time>=20211030 and day_time<=20220404
and server_id in (10001,10002,10003)
and map_id='31010001'
group by 1,2) b1 
group by 1) b 
on a.role_id=b.role_id
left join 
(
select role_id,sum(pay_price) as pay 
from fairy_town.order_pay
where day_time>=20210420 
and server_id in (10001,10002,10003)
group by 1
) c 
on a.role_id=c.role_id
) as c
on a.role_id=c.role_id
group by 1,2,3,4,5,6,7,8,9,10





goods获得
那麻烦再帮我确认一下，筛选出的这批没修建过建筑的玩家，在本期万圣节v3期间（2022年10月26日-11月5日），有没有获得过以下这些这些Goods ID：
条件1：
310145
310146
310147
310148
310149
310150

select role_id,date_time,enter_method,item_ids,item_num
from fairy_town_server.server_enter_gift_box
where day_time >= 20221026 and day_time <= 20221105
and server_id in (10001,10002,10003)
and item_ids in ('310145','310146','310147','310148','310149','310150')
and role_id In (
'1000200000000508060'
,'1000200000000088417'
,'1000100000000504990'
,'1000100000000582254'
,'1000300000000462001'
,'1000300000000352817'
,'1000200000000364001'
,'1000100000000132392'
,'1000300000000582982'
,'1000300000000131851'
,'1000300000000440796'
,'1000200000000569417'
,'1000200000000473390'
,'1000100000000584541'
,'1000200000000738384'
,'1000200000000236444'
,'1000200000000790817'
,'1000200000000677567'
,'1000300000000462372'
,'1000300000000554462'
,'1000100000000125865'
,'1000100000000434485'
,'1000200000000839848'
,'1000100000000063137'
,'1000100000000306054'
,'1000100000000495878'
,'1000300000000567774'
,'1000200000000111648'
,'1000200000000582781'
,'1000100000000249512'
,'1000200000000076182'
,'1000200000000013006'
,'1000200000000759674'
,'1000300000000469597'
,'1000300000000200887'
,'1000200000000797792'
,'1000100000000109066'
,'1000200000000506074'
,'1000100000000557976'
,'1000100000000422979'
,'1000100000000608232'
,'1000100000000103526'
,'1000100000000409799'
,'1000300000000098659'
,'1000100000000265310'
,'1000300000000145425'
,'1000100000000601686'
,'1000300000000143845'
,'1000200000000207228'
,'1000300000000317365'
,'1000300000000217037'
,'1000100000000207644'
,'1000300000000570844'
,'1000200000000482147'
,'1000200000000490213'
,'1000200000000345588'
,'1000100000000221994'
,'1000300000000365875'
,'1000200000000754776'
,'1000300000000594052'
,'1000300000000413182'
,'1000300000000042416'
,'1000100000000076498'
,'1000300000000090878'
,'1000200000000712056'
,'1000200000000387541'
,'1000100000000495549'
,'1000200000000151702'
,'1000200000000196242'
,'1000300000000582758'
,'1000200000000586093'
,'1000300000000641681'
,'1000200000000818533'
,'1000300000000208730'
,'1000100000000602522'
,'1000200000000432565'
,'1000100000000024305'
,'1000100000000404519'
,'1000200000000034623'
,'1000300000000561825'
,'1000300000000201656'
,'1000200000000240473'
,'1000300000000390526'
,'1000200000000242810'
,'1000300000000273785'
,'1000300000000346984'
,'1000100000000484353'
,'1000300000000263216'
,'1000200000000307207'
,'1000200000000411657'
,'1000200000000181213'
,'1000200000000761775'
,'1000100000000607874'
,'1000300000000097505'
,'1000300000000634449'
,'1000300000000144350'
,'1000100000000567317'
,'1000100000000500595'
,'1000200000000239279'
,'1000100000000618587'
,'1000200000000770652'
,'1000100000000462481'
,'1000200000000745066'
,'1000100000000263908'
,'1000200000000845737'
,'1000100000000121856'
,'1000200000000594218'
,'1000300000000308256'
,'1000200000000231413'
,'1000100000000141330'
,'1000200000000542907'
,'1000100000000369581'
,'1000300000000396767'
,'1000100000000323994'
,'1000300000000347361'
,'1000100000000296514'
,'1000300000000298438'
,'1000100000000539107'
,'1000300000000340607'
,'1000200000000269873'
,'1000300000000520105'
,'1000100000000407879'
,'1000200000000058621'
,'1000300000000168785'
,'1000300000000368620'
,'1000200000000758370'
,'1000300000000093280'
,'1000200000000300856'
,'1000200000000614815'
,'1000300000000488327'
,'1000200000000016519'
,'1000200000000115237'
,'1000200000000327690'
,'1000200000000752440'
,'1000100000000216640'
,'1000100000000450067'
,'1000200000000532736'
,'1000300000000156430'
,'1000300000000176305'
,'1000100000000490375'
,'1000100000000522842'
,'1000300000000501721'
,'1000300000000236404'
,'1000200000000061124'
,'1000200000000572918'
,'1000200000000566382'
,'1000100000000594305'
,'1000200000000829080'
,'1000200000000054360'
,'1000300000000426387'
,'1000200000000529047'
,'1000200000000526212'
,'1000200000000810931'
,'1000100000000551485'
,'1000200000000277719'
,'1000200000000673717'
,'1000300000000447593'
,'1000100000000087183'
,'1000100000000368196'
,'1000100000000564445'
,'1000100000000231681'
,'1000200000000829159'
,'1000100000000375928'
,'1000200000000753179'
,'1000200000000074329'
,'1000100000000224435'
,'1000200000000484369'
,'1000200000000309631'
,'1000100000000083135'
,'1000200000000557397'
,'1000300000000639924'
,'1000200000000702145'
,'1000200000000293917'
,'1000300000000233637'
,'1000200000000819040'
,'1000100000000312289'
,'1000300000000454072'
,'1000200000000752771'
,'1000200000000243286'
,'1000200000000492618'
,'1000300000000512914'
,'1000200000000500729'
,'1000100000000446209'
,'1000200000000679621'
,'1000100000000124933'
,'1000100000000519355'
,'1000200000000569788'
,'1000300000000517458'
,'1000200000000655643'
,'1000300000000132476'
,'1000200000000709604'
,'1000100000000061471'
,'1000300000000403126'
,'1000100000000445368'
,'1000200000000819095'
,'1000200000000154826'
,'1000100000000066086'
,'1000200000000675627'
,'1000100000000496362'
,'1000300000000566264'
,'1000200000000713105'
,'1000100000000075390'
,'1000200000000500228'
,'1000100000000474321'
,'1000300000000114821'
,'1000300000000611019'
,'1000300000000514857'
,'1000100000000454717'
,'1000200000000625657'
,'1000100000000205586'
,'1000200000000623042'
,'1000100000000193768'
,'1000200000000532595'
,'1000200000000678818'
,'1000300000000338097'
,'1000200000000747065'
,'1000300000000111576'
,'1000200000000423842'
,'1000300000000154432'
,'1000100000000173438'
,'1000200000000358497'
,'1000200000000688313'
,'1000300000000610352'
,'1000200000000838217'
,'1000200000000474207'
,'1000300000000452882'
,'1000200000000832137'
,'1000100000000230601'
,'1000300000000582057'
,'1000200000000832956'
,'1000300000000325546'
,'1000200000000748015'
,'1000300000000513331'
,'1000300000000532587'
,'1000200000000739625'
,'1000300000000076031'
,'1000300000000257378'
,'1000100000000579852'
,'1000300000000420005'
,'1000100000000575930'
,'1000200000000582144'
,'1000300000000262086'
,'1000200000000540013'
,'1000200000000838706'
,'1000300000000132332'
,'1000200000000532040'
,'1000100000000119987'
,'1000200000000535174'
,'1000100000000341157'
,'1000300000000261158'
,'1000100000000128635'
,'1000300000000336063'
,'1000300000000475231'
,'1000300000000554391'
,'1000300000000276378'
,'1000200000000535481'
,'1000100000000461929'
,'1000300000000491797'
,'1000100000000087668'
,'1000300000000131147'
,'1000200000000673581'
,'1000200000000361784'
,'1000100000000157046'
,'1000300000000161267'
,'1000300000000508659'
,'1000300000000314952'
,'1000300000000617865'
,'1000300000000438160'
,'1000300000000478880'
,'1000200000000268831'
,'1000200000000044080'
,'1000200000000823025'
,'1000200000000645822'
,'1000100000000209852'
,'1000200000000535907'
,'1000300000000583692'
,'1000100000000115124'
,'1000200000000292614'
,'1000100000000064259'
,'1000200000000459723'
,'1000100000000192151'
,'1000200000000600479'
,'1000200000000738965'
,'1000200000000030458'
,'1000100000000286031'
,'1000300000000385917'
,'1000200000000829872'
,'1000100000000442001'
,'1000300000000521428'
,'1000200000000215031'
,'1000200000000840900'
,'1000300000000178628'
,'1000300000000306605'
,'1000200000000013235'
,'1000300000000263241'
,'1000200000000069396'
,'1000100000000028144'
,'1000200000000756603'
,'1000300000000275408'
,'1000200000000254723'
,'1000200000000728559'
,'1000100000000316078'
,'1000200000000185765'
,'1000100000000357617'
,'1000100000000548819'
,'1000100000000156948'
,'1000300000000120179'
,'1000200000000781404'
,'1000300000000220981'
,'1000200000000837498'
,'1000200000000544611'
,'1000300000000420717'
,'1000200000000771154'
,'1000300000000608211'
,'1000300000000567912'
,'1000200000000731378'
,'1000300000000104920'
,'1000200000000507433'
,'1000200000000532912'
,'1000300000000470465'
,'1000200000000364171'
,'1000100000000166742'
,'1000300000000535658'
,'1000100000000048272'
,'1000300000000604436'
,'1000300000000048041'
,'1000200000000413343'
,'1000200000000770039'
,'1000200000000594642'
,'1000200000000114288'
,'1000200000000715401'
,'1000200000000342696'
,'1000100000000382681'
,'1000200000000001010'
,'1000300000000626272'
,'1000300000000361371'
,'1000300000000105563'
,'1000100000000484021'
,'1000200000000268667'
,'1000100000000269825'
,'1000100000000382280'
,'1000300000000605265'
,'1000200000000794473'
,'1000200000000798264'
,'1000200000000381630'
,'1000200000000801080'
,'1000200000000415853'
,'1000100000000452579'
,'1000100000000495843'
,'1000200000000630948'
,'1000200000000706371'
,'1000200000000635635'
,'1000200000000367600'
,'1000300000000566031'
,'1000200000000330407'
,'1000200000000550578'
,'1000100000000387939'
,'1000100000000237184'
,'1000300000000272845'
,'1000300000000628044'
,'1000100000000046789'
,'1000300000000632039'
,'1000100000000321508'
,'1000100000000394075'
,'1000200000000774638'
,'1000300000000236081'
,'1000300000000352652'
,'1000100000000245638'
,'1000100000000155912'
,'1000100000000601230'
,'1000200000000030118'
,'1000200000000718049'
,'1000200000000464103'
,'1000300000000609132'
,'1000200000000713442'
)
group by 1,2,3,4,5
order by 1,2,3,4,5


条件2：
310151
310152
310153
310154
310155
310156

select role_id,date_time,enter_method,item_ids,item_num
from fairy_town_server.server_enter_gift_box
where day_time >= 20221026 and day_time <= 20221105
and server_id in (10001,10002,10003)
and item_ids in ('310151','310152','310153','310154','310155','310156')
and role_id In (
'1000200000000293917'
,'1000200000000770652'
,'1000300000000178628'
,'1000300000000535658'
,'1000100000000474321'
,'1000300000000475231'
,'1000100000000132392'
,'1000200000000381630'
,'1000300000000609132'
,'1000300000000263216'
,'1000300000000352652'
,'1000300000000491797'
,'1000100000000125865'
,'1000100000000407879'
,'1000300000000514857'
,'1000100000000454717'
,'1000300000000520105'
,'1000200000000582144'
,'1000300000000340607'
)
group by 1,2,3,4,5
order by 1,2,3,4,5











等级区间 金币 钻石存量
select case when role_level >=1 and role_level <= 10 then '1-10'
            when role_level >=11 and role_level <= 20 then '11-20'
            when role_level >=21 and role_level <= 30 then '21-30'
            when role_level >=31 and role_level <= 40 then '31-40'
            when role_level >=41 and role_level <= 50 then '41-50'
            when role_level >=51 and role_level <= 60 then '51-60'
            when role_level >60 then '60+'
        end as '等级区间',
       count(distinct role_id) as '角色数',
       round(avg(gold),0) as '金币-平均数',
       appx_median(gold) '金币-中位数',
       round(avg(gem),0) as '钻石-平均数',
       appx_median(gem) '钻石-中位数'
from fairy_town_server.server_login_snap_shot
where day_time >= ${start_time} and day_time <= ${end_time}
and server_id in (${serverIds})
group by 1
order by 1
